<!doctype html>
<html lang="en">
  <head>
  	<title>Add Product - Blockchain Product Authentication</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link href='https://fonts.googleapis.com/css?family=Inter:400,500,600,700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/common.css">
	<link rel="stylesheet" href="css/style.css">
	<style>
		/* Page specific styles */
		body {
			background: linear-gradient(135deg, #0f4c3a 0%, #1a5f4d 50%, #11998e 100%);
		}

		.main-content {
			padding: 40px 0;
		}

		.page-title {
			color: white;
			text-align: center;
			margin-bottom: 30px;
			font-size: 2.2rem;
			font-weight: 700;
		}

		.form-card {
			background: white;
			border-radius: 20px;
			padding: 40px;
			box-shadow: 0 15px 50px rgba(0,0,0,0.2);
		}

		.back-link {
			display: inline-flex;
			align-items: center;
			gap: 8px;
			color: white;
			text-decoration: none;
			padding: 10px 20px;
			border-radius: 10px;
			background: rgba(255,255,255,0.1);
			-webkit-backdrop-filter: blur(10px);
			backdrop-filter: blur(10px);
			margin-bottom: 30px;
			transition: all 0.3s ease;
		}

		.back-link:hover {
			background: rgba(255,255,255,0.2);
			transform: translateY(-2px);
		}
		.back-to-dashboard {
			display: flex;
			align-items: center;
			gap: 8px;
			z-index: 1000;
			transition: background-color 0.3s;
		}
		.back-to-dashboard:hover {
			background: #764ba2;
			color: white;
		}
		/* Hidden elements controlled by JS */
		#qrSection, #imgQR, #downloadBtn { display: none; }
		body {
			font-family: 'Inter', sans-serif;
			background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
			min-height: 100vh;
		}
		
		.dashboard-header {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			color: white;
			padding: 20px 0;
			margin-bottom: 30px;
			box-shadow: 0 4px 15px rgba(0,0,0,0.1);
		}
		
		.main-container {
			max-width: 900px;
			margin: 0 auto;
			padding: 0 20px;
		}
		
		.form-card {
			background: white;
			border-radius: 20px;
			box-shadow: 0 10px 30px rgba(0,0,0,0.1);
			padding: 40px;
			margin-bottom: 30px;
		}
		
		.form-card h2 {
			color: #2c3e50;
			font-weight: 700;
			margin-bottom: 30px;
			display: flex;
			align-items: center;
			gap: 15px;
		}
		
		.form-grid {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
			gap: 25px;
			margin-bottom: 30px;
		}
		
		.form-group {
			position: relative;
		}
		
		.form-group label {
			font-weight: 600;
			color: #34495e;
			margin-bottom: 8px;
			display: block;
		}
		
		.form-control {
			border: 2px solid #e9ecef;
			border-radius: 10px;
			padding: 12px 16px;
			font-size: 16px;
			transition: all 0.3s ease;
		}
		
		.form-control:focus {
			border-color: #667eea;
			box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
		}
		
		.btn-modern {
			background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
			border: none;
			color: white;
			padding: 15px 30px;
			border-radius: 10px;
			font-weight: 600;
			font-size: 16px;
			display: inline-flex;
			align-items: center;
			gap: 10px;
			transition: all 0.3s ease;
			text-decoration: none;
		}
		
		.btn-modern:hover {
			transform: translateY(-2px);
			box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
			color: white;
		}
		
		.btn-download {
			background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
		}
		
		.btn-download:hover {
			box-shadow: 0 8px 25px rgba(40, 167, 69, 0.3);
		}
		
		.qr-section {
			background: white;
			border-radius: 20px;
			padding: 40px;
			text-align: center;
			box-shadow: 0 10px 30px rgba(0,0,0,0.1);
			margin-top: 30px;
		}
		
		.qr-section h3 {
			color: #2c3e50;
			margin-bottom: 20px;
		}
		
		.qr-display {
			background: #f8f9fa;
			border-radius: 15px;
			padding: 30px;
			margin: 20px 0;
			border: 2px dashed #dee2e6;
		}
		
		#imgQR {
			max-width: 200px;
			height: auto;
			border-radius: 10px;
		}
		
		.breadcrumb-modern {
			background: rgba(255,255,255,0.1);
			padding: 10px 20px;
			border-radius: 10px;
			margin-bottom: 20px;
		}
		
		.breadcrumb-modern a {
			color: white;
			text-decoration: none;
			opacity: 0.8;
		}
		
		.breadcrumb-modern a:hover {
			opacity: 1;
		}
		
		.back-btn {
			position: absolute;
			top: 20px;
			left: 20px;
			background: rgba(255,255,255,0.2);
			color: white;
			border: none;
			padding: 10px 15px;
			border-radius: 10px;
			display: flex;
			align-items: center;
			gap: 8px;
			text-decoration: none;
		}
		
		.back-btn:hover {
			background: rgba(255,255,255,0.3);
			color: white;
		}
		
		@media (max-width: 768px) {
			.form-grid {
				grid-template-columns: 1fr;
			}
			
			.form-card {
				padding: 20px;
			}
		}
	</style>
	</head>
	<body>
		<div class="dashboard-header">
			<div class="main-container">
				<a href="manufacturer.html" class="back-btn">
					<i class="fas fa-arrow-left"></i>
					Back to Dashboard
				</a>
				
				<div class="breadcrumb-modern">
					<a href="manufacturer.html">Manufacturer Dashboard</a> / Add Product
				</div>
				
				<h1 class="mb-0">
					<i class="fas fa-cube"></i>
					Product Registration
				</h1>
				<p class="mb-0 opacity-75">Register a new product on the blockchain network</p>
			</div>
		</div>

		<div class="main-container">
			<div class="form-card">
				<h2>
					<i class="fas fa-plus-circle text-primary"></i>
					Product Information
				</h2>
				
				<form id="addProductForm" class="product-form">
					<div class="form-grid">
						<div class="form-group">
							<label for="productName">
								<i class="fas fa-box me-2"></i>
								Product Name
							</label>
							<input class="form-control" id="productName" name="productName" type="text" placeholder="Enter product name" required />
						</div>
						
						<div class="form-group">
							<label for="productId">
								<i class="fas fa-tag me-2"></i>
								Product ID
							</label>
							<input class="form-control" id="productId" name="productId" type="text" placeholder="Enter product ID" required />
						</div>
						
						<div class="form-group">
							<label for="manufacturer">
								<i class="fas fa-industry me-2"></i>
								Manufacturer
							</label>
							<input class="form-control" id="manufacturer" name="manufacturer" type="text" placeholder="Enter manufacturer name" required />
						</div>
						
						<div class="form-group">
							<label for="manufacturingDate">
								<i class="fas fa-calendar-alt me-2"></i>
								Manufacturing Date
							</label>
							<input class="form-control" id="manufacturingDate" name="manufacturingDate" type="date" />
						</div>
						
						<div class="form-group">
							<label for="expiryDate">
								<i class="fas fa-calendar-times me-2"></i>
								Expiry Date
							</label>
							<input class="form-control" id="expiryDate" name="expiryDate" type="date" />
						</div>
						
						<div class="form-group">
							<label for="category">
								<i class="fas fa-list me-2"></i>
								Category
							</label>
							<select class="form-control" id="category" name="category">
								<option value="">Select Category</option>
								<option value="electronics">Electronics</option>
								<option value="pharmaceutical">Pharmaceutical</option>
								<option value="food">Food & Beverage</option>
								<option value="cosmetics">Cosmetics</option>
								<option value="other">Other</option>
							</select>
						</div>
						
						<div class="form-group">
							<label for="price">
								<i class="fas fa-dollar-sign me-2"></i>
								Price (ETH)
							</label>
							<input class="form-control" id="price" name="price" type="number" step="0.001" placeholder="Enter price in ETH" />
						</div>
						
						<div class="form-group">
							<label for="description">
								<i class="fas fa-info-circle me-2"></i>
								Description
							</label>
							<textarea class="form-control" id="description" name="description" rows="4" placeholder="Enter product description"></textarea>
						</div>
						
						<div class="form-group">
							<label for="productImage">
								<i class="fas fa-image me-2"></i>
								Product Image
							</label>
							<input class="form-control" id="productImage" name="productImage" type="file" accept="image/*" />
							<div id="imagePreview"></div>
						</div>
					</div>
					
					<div class="text-center">
						<button type="submit" class="btn-modern">
							<i class="fas fa-plus"></i>
							Add Product
						</button>
					</div>
				</form>
			</div>

			<div class="qr-section" id="qrSection">
				<h3>
					<i class="fas fa-qrcode text-success me-2"></i>
					Product QR Code Generated
				</h3>
				<p class="text-muted">Your product has been successfully registered on the blockchain.</p>
				
				<div class="qr-display">
					<img id="imgQR" src="" alt="Product QR Code" />
					<div id="qrPlaceholder">
						<i class="fas fa-qrcode fa-3x text-muted"></i>
						<p class="text-muted mt-2">QR Code will appear here</p>
					</div>
				</div>
				
				<div class="mt-3">
					<button class="btn-modern btn-download" id="downloadBtn" onclick="downloadQR()">
						<i class="fas fa-download"></i>
						Download QR Code
					</button>
				</div>
				
				<div class="mt-3 text-muted">
					<small>
						<i class="fas fa-info-circle me-1"></i>
						This QR code contains the product's blockchain hash for verification
					</small>
				</div>
			</div>
		</div>

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/web3.min.js"></script>
		<script src="js/truffle-contract.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"></script>
		
		<script>
			var qrValue;
			var src;

			function registerProduct() {
				// Get form values
				const manufacturerID = document.getElementById('manufacturerID').value;
				const productName = document.getElementById('productName').value;
				const productSN = document.getElementById('productSN').value;
				const productBrand = document.getElementById('productBrand').value;
				const productPrice = document.getElementById('productPrice').value;
				const productCategory = document.getElementById('productCategory').value;

				// Basic validation
				if (!manufacturerID || !productName || !productSN || !productBrand || !productPrice || !productCategory) {
					alert('Please fill in all fields');
					return;
				}

				// Show loading state
				const btn = event.target;
				const originalText = btn.innerHTML;
				btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Registering...';
				btn.disabled = true;

				// Simulate blockchain registration
				setTimeout(() => {
					// Generate QR code
					generateQR();
					
					// Reset button
					btn.innerHTML = originalText;
					btn.disabled = false;
					
					// Show success message
					showSuccess();
				}, 2000);
			}

			function generateQR() {
				qrValue = document.getElementById('productSN').value;
				const qrImage = document.getElementById('imgQR');
				src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${qrValue}`;
				
				qrImage.src = src;
				qrImage.style.display = 'block';
				
				document.getElementById('qrPlaceholder').style.display = 'none';
				document.getElementById('downloadBtn').style.display = 'inline-flex';
				document.getElementById('qrSection').style.display = 'block';
				
				// Scroll to QR section
				document.getElementById('qrSection').scrollIntoView({ behavior: 'smooth' });
			}

			function downloadQR() {
				if (src && qrValue) {
					saveAs(src, `${qrValue}-qr-code.png`);
					
					// Show download success
					const btn = document.getElementById('downloadBtn');
					const originalText = btn.innerHTML;
					btn.innerHTML = '<i class="fas fa-check"></i> Downloaded!';
					
					setTimeout(() => {
						btn.innerHTML = originalText;
					}, 2000);
				}
			}

			function showSuccess() {
				// Create success notification
				const notification = document.createElement('div');
				notification.className = 'alert alert-success';
				notification.style.cssText = 'position: fixed; top: 20px; right: 20px; z-index: 1000; border-radius: 10px;';
				notification.innerHTML = '<i class="fas fa-check-circle me-2"></i>Product successfully registered on blockchain!';
				
				document.body.appendChild(notification);
				
				setTimeout(() => {
					notification.remove();
				}, 3000);
			}
		</script>

    <!-- Scripts at end of body -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="js/web3.min.js"></script>
    <script src="js/truffle-contract.js"></script>
    <script src="js/ipfsService.js"></script>
    <script src="js/addProductWithIPFS.js"></script>
    
    <script>
        var qrValue, src;
        function downloadQR() {
            if (src && qrValue) {
                const link = document.createElement('a');
                link.href = src;
                link.download = `${qrValue}-qr-code.png`;
                link.click();
            }
        }
        function generateQR(productSN) {
            qrValue = productSN;
            const qrImage = document.getElementById('imgQR');
            src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${qrValue}`;
            qrImage.src = src;
            qrImage.style.display = 'block';
            document.getElementById('qrPlaceholder').style.display = 'none';
            document.getElementById('downloadBtn').style.display = 'inline-flex';
            document.getElementById('qrSection').style.display = 'block';
            document.getElementById('qrSection').scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>